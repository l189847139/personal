# Redis Sentinel 配置
# 说明：此配置用于启动 Redis Sentinel，负责监控主节点并在必要时执行故障转移（failover）。
# 注意：文件可能包含明文密码（auth-pass），请确保文件权限受限（例如 chmod 600）或使用更安全的凭据管理方式。

# ----------------------------- 基本设置 -----------------------------
# 是否以守护进程方式运行（后台）
daemonize yes
# 绑定的网络接口；0.0.0.0 表示监听所有接口（必要时改为具体 IP）
bind 0.0.0.0
# Sentinel 服务监听端口
port 26380

# ----------------------------- 日志与路径 -----------------------------
# 工作目录（用于持久化临时文件）
dir "/data/redis/sentry/tmp"
# 日志文件
logfile "/data/redis/sentry/logs/redis-sentinel-26380.log"
# 进程 PID 文件（建议以 sentinel 命名以便于区分）
pidfile "/data/redis/sentry/pid/redis-sentinel-26380.pid"
# 日志级别（可选：debug, verbose, notice, warning）
loglevel notice
# TCP keepalive（秒），用于维持连接健康
tcp-keepalive 60

# ----------------------------- 安全相关 -----------------------------
# 是否开启保护模式（建议在受信任网络内或有额外访问控制时关闭）
protected-mode no
# 禁止通过脚本重置配置，能防止被恶意脚本或误操作改写重要配置
sentinel deny-scripts-reconfig yes

# ----------------------------- 监控与故障转移 -----------------------------
# 监控主节点：格式 -> sentinel monitor <name> <ip> <port> <quorum>
# quorum 表示至少多少个哨兵达成一致后才会发起故障转移操作（3 个 sentinel 推荐 quorum=2）
sentinel monitor redis-master 10.68.133.38 6379 2
# 当发生 failover 时，最多允许并行同步的 replica 数量（减小主节点瞬时压力）
sentinel parallel-syncs redis-master 1

# 下面为超时与判定设置（单位：毫秒）
# 没有收到主节点响应后，主观认为主节点下线的时间阈值（建议适度增大以避免短暂网络抖动误判）
sentinel down-after-milliseconds redis-master 5000
# failover 操作允许的最长时间，超过则认为此次 failover 失败（建议明显大于 down-after-milliseconds）
sentinel failover-timeout redis-master 60000

# 如果主节点设置了 requirepass，则配置该密码以便哨兵能验证连接
# 注意：密码以明文形式存在，建议限制此文件访问权限并考虑更安全的凭据管理方案
sentinel auth-pass redis-master dfredis2024zq

# ----------------------------- 自动化与通知（按需启用） -----------------------------
# 当 Sentinel 检测到重要事件时，可调用脚本发送通知（示例为注释，需要替换为真实脚本路径）
# sentinel notification-script redis-master /opt/sentinel/notify.sh
# failover 完成后可执行客户端重配置脚本以更新代理/负载均衡器等（示例为注释）
# sentinel client-reconfig-script redis-master /opt/sentinel/client_reconfig.sh

# 若运行在容器或 NAT 环境下，可以显式声明对外可达地址（按需启用）
# sentinel announce-ip 1.2.3.4
# sentinel announce-port 26380

# ----------------------------- 备注 -----------------------------
# - 请确认目录与日志路径存在且权限正确（例如 chown/chmod 合理设置）。
# - 为减少凭据泄露风险，可将配置文件权限减少至 600：
#   chmod 600 /path/to/sentinel.conf
# - 对于生产环境，建议根据具体网络与复制拓扑评估 down-after-milliseconds 与 failover-timeout 的合理值。